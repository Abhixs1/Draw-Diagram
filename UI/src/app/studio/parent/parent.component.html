<div class="app-container"> 
    <!-- ðŸ”· Top Branding Header with Logo -->
    <div class="app-header-top">
      
      <img src="assets/logo-mavim.png" alt="Mavim Logo" class="header-logo" />
        <div class="header-right">
          
        <ng-container *ngIf="isProfileLoaded">
          <button mat-icon-button [matMenuTriggerFor]="userMenu" class="user-btn">
            <img [src]="userPhotoUrl" alt="Profile" class="user-pic" *ngIf="userPhotoUrl" />
          </button>
        </ng-container>

        <mat-menu #userMenu="matMenu" class="profile-dropdown">
          <div class="profile-card">
            <img [src]="userPhotoUrl" alt="Profile" class="profile-avatar" />
            <div class="profile-info">
              <div class="profile-name">{{ userName }}</div>
              <div class="profile-email">{{ userPrincipalName }}</div>
            </div>
            <button class="signout-btn" (click)="logout()">Sign out</button>
          </div>
        </mat-menu>

  </div>
    </div>

    <!-- ðŸ”¶ Sub Header: Center Inputs + Right Buttons -->
    <div class="app-header-sub">
        <div class="subheader-left">
        <button class="icon-button" title="Home" [routerLink]="'/home'">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16">
            <path fill="currentColor" d="M16 6.6L8 1.4L6 2.7V1H4v3L0 6.6l1.9 2.7l.1-.1V15h5v-4h2v4h5V9.2l.1.1zm-14.6.3L8 2.6l6.6 4.3l-.7 1L8 4L2.1 7.9zM13 14h-3v-4H6v4H3V8.6l5-3.3l5 3.3z"/>
          </svg>
        </button>
                  <!-- ðŸ”˜ SVG Menu Trigger Button -->
          <button mat-button [matMenuTriggerFor]="magicMenu">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 1024 1024">
              <path fill="currentColor" d="M160 448a32 32 0 0 1-32-32V160.064a32 32 0 0 1 32-32h256a32 32 0 0 1 32 32V416a32 32 0 0 1-32 32zm448 0a32 32 0 0 1-32-32V160.064a32 32 0 0 1 32-32h255.936a32 32 0 0 1 32 32V416a32 32 0 0 1-32 32zM160 896a32 32 0 0 1-32-32V608a32 32 0 0 1 32-32h256a32 32 0 0 1 32 32v256a32 32 0 0 1-32 32zm448 0a32 32 0 0 1-32-32V608a32 32 0 0 1 32-32h255.936a32 32 0 0 1 32 32v256a32 32 0 0 1-32 32z"/>
            </svg>
          </button>

          <!-- ðŸ”¼ Menu Displayed Above -->
          <mat-menu
            #magicMenu="matMenu"
            yPosition="above"
            class="custom-menu-panel"
          >
            <button mat-menu-item (click)="createNewFile()">New</button>
            <button mat-menu-item (click)="deleteCurrentFile()">Delete</button>
            <button mat-menu-item  (click)="downloadPDF()">Save as PDF</button>
          </mat-menu>

        </div>
      <div class="subheader-center">
        <input
          class="header-btn editor"
          [(ngModel)]="titleTag"
          (ngModelChange)="onTitleChange($event)"
          placeholder="Diagram title" />

        <input
          class="header-btn user"
          [(ngModel)]="versionTag"
          (ngModelChange)="onUserChange($event)"
          placeholder="Version" />
      </div>

      <div class="subheader-right">
<!-- Save Button with matMenuTrigger -->
<!-- Save Button with matMenuTriggerFor -->
<!-- Use a normal button and apply the menu trigger manually -->
<!-- Save Button in Toolbar -->
<button
  #saveTrigger="matMenuTrigger"
  [matMenuTriggerFor]="saveMenu"
  [disabled]="!hasDiagramContent()"
  class="icon-button"
  title="Save">

  <!-- Your SVG icon remains -->
  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 48 48">
    <defs>
      <mask id="ipSDownloadWeb0">
        <g fill="none">
          <path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="4"
                d="M27 40H7a3 3 0 0 1-3-3V11a3 3 0 0 1 3-3h34a3 3 0 0 1 3 3v13M34 36l5 5l5-5m-5-7v12"/>
          <path fill="#fff" stroke="#fff" stroke-width="4"
                d="M4 11a3 3 0 0 1 3-3h34a3 3 0 0 1 3 3v9H4z"/>
          <circle r="2" fill="#000" transform="matrix(0 -1 -1 0 10 14)"/>
          <circle r="2" fill="#000" transform="matrix(0 -1 -1 0 16 14)"/>
        </g>
      </mask>
    </defs>
    <path fill="currentColor" d="M0 0h48v48H0z" mask="url(#ipSDownloadWeb0)"/>
  </svg>
</button>

<!-- Save Dialog Template -->
<mat-menu #saveMenu="matMenu" class="custom-save-menu" [overlapTrigger]="false">
  <div matMenuContent (click)="$event.stopPropagation()">
    <form class="sketch-form" (ngSubmit)="saveDiagram(saveTrigger)">
      <h3 class="form-title">Save Model</h3>

      <div class="form-row">
        <div class="field-group">
          <label for="modelName">Model Name</label>
          <input id="modelName" [(ngModel)]="diagramName" name="modelName" (ngModelChange)="fetchAndSetVersionNumber()" />
        </div>
        <div class="field-group small">
          <label for="version">Version</label>
          <input id="version" [value]="versionNumber" disabled />
        </div>
      </div>

      <div class="field-group full">
        <label for="description">Description</label>
        <textarea id="description" rows="2" [(ngModel)]="diagramDescription" name="modelDescription" placeholder="optional"></textarea>
      </div>

      <div class="form-actions">
        <button type="submit">Save</button>
      </div>
    </form>
  </div>
</mat-menu>






      <button class="icon-button" (click)="onLoad()" title="Load">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 16 16"><path fill="currentColor" d="M7 9h2V5h3L8 1L4 5h3zm3-2.25v1.542L14.579 10L8 12.453L1.421 10L6 8.292V6.75L0 9v4l8 3l8-3V9z"/></svg>
      </button>
      <button class="icon-button" title="Versions" (click)="openVersionsDialog()">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M10 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h11a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2Zm-.5-2a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5V4a.5.5 0 0 0-.5-.5H10a.5.5 0 0 0-.5.5ZM6.17 4.165a.75.75 0 0 1-.335 1.006c-.228.114-.295.177-.315.201a.04.04 0 0 0-.008.016a.4.4 0 0 0-.012.112v13c0 .07.008.102.012.112a.03.03 0 0 0 .008.016c.02.024.087.087.315.201a.749.749 0 1 1-.67 1.342c-.272-.136-.58-.315-.81-.598C4.1 19.259 4 18.893 4 18.5v-13c0-.393.1-.759.355-1.073c.23-.283.538-.462.81-.598a.75.75 0 0 1 1.006.336ZM2.15 5.624a.75.75 0 0 1-.274 1.025q-.225.132-.32.245C1.5 6.96 1.5 6.99 1.5 7v10c0 .01 0 .04.056.106q.095.113.32.245a.75.75 0 0 1-.752 1.298C.73 18.421 0 17.907 0 17V7c0-.907.73-1.42 1.124-1.65a.75.75 0 0 1 1.025.274Z"/></svg>
      </button>

      </div>
    </div>

    <!-- Main Layout -->
    <div class="main-content">
      <app-sidebar
        (shapeDropped)="onShapeDropped($event)"
        (arrowModeToggled)="onArrowModeToggled($event)">
      </app-sidebar>

      <div class="canvas-area">
        <app-canvas
          #canvas
          [selectedElement]="selectedElement"
          (elementSelected)="onElementSelected($event)"
          (elementDeselected)="onElementDeselected()">
        </app-canvas>

        <app-zoom-controls
          [zoomLevel]="currentZoom"
          (zoomIn)="onZoomIn()"
          (zoomOut)="onZoomOut()"
          (resetZoom)="onResetZoom()"
          (clearCanvas)="onClearCanvas()"
          (exportGraph)="onExportGraph()"
          (importGraph)="onImportGraph($event)"
          (undo)="onUndo()"
          (redo)="onRedo()">
        </app-zoom-controls>
      </div>

      <app-properties-panel
        [selectedElement]="selectedElement"
        (propertyChanged)="onPropertyChanged($event)"
        (deleteElement)="onDeleteElement()">
      </app-properties-panel>
    </div>
    <ng-template #versionsDialog>
  <h2 mat-dialog-title>Available Versions</h2>
  <mat-dialog-content>
    <div *ngFor="let version of selectedDiagramVersions" class="version-row">
      <span>{{diagramName}} v{{ version }}</span>
      <div class="version-actions">
        <button mat-stroked-button color="primary" (click)="loadVersion(version); dialog.closeAll()">
          Load
        </button>
        <button mat-icon-button color="warn" (click)="deleteVersion(version)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </div>
  </mat-dialog-content>
</ng-template>

  </div>

    <!-- âœ… Footer Tab Navigation with full functionality -->
<div class="tab-footer-bar">
  <mat-tab-group
    [(selectedIndex)]="activeTabIndex"
    (selectedIndexChange)="onTabChange($event)"
    class="footer-tab-group custom-footer-tabs"
    [disableRipple]="true"
  >
    <mat-tab *ngFor="let file of files; let i = index">
      <ng-template mat-tab-label>
<div class="footer-tab-label" [class.selected]="activeTabIndex === i">
  <svg *ngIf="activeTabIndex === i" class="tab-pin-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
    <path fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5"
          d="m15 4.5l-4 4L7 10l-1.5 1.5l7 7L14 17l1.5-4l4-4M9 15l-4.5 4.5M14.5 4L20 9.5"/>
  </svg>

  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
    <g fill="none">
      <path d="M0 0h24v24H0z" />
      <path fill="#42a5f5" d="M8 16h8v2H8zm0-4h8v2H8zm6-10H6c-1.1 0-2 .9-2 2v16c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5z" />
    </g>
  </svg>

  <ng-container *ngIf="renameTabIndex === i; else displayName">
    <input
      type="text"
      [(ngModel)]="files[i].name"
      (blur)="disableRename()"
      (keydown.enter)="disableRename()"
      class="tab-rename-input"
      autofocus
    />
  </ng-container>

  <ng-template #displayName>
    <span (dblclick)="enableRename(i)">
      {{ file.name }}
    </span>
  </ng-template>

  <button
    mat-icon-button
    class="tab-close-btn"
    (click)="deleteCurrentFile()"
  >
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
	<path fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m11.25 4.75l-6.5 6.5m0-6.5l6.5 6.5" />
</svg>
  </button>
</div>


      </ng-template>
    </mat-tab>
  </mat-tab-group>
  
</div>
